# Ralph Progress Log

## Codebase Patterns
- This is a Next.js 16 web app, NOT React Native/Flutter mobile
- Uses Tailwind CSS v4 for styling
- App router in src/app/ directory
- Components go in src/app/components/
- Utilities/lib files go in src/app/lib/
- Use "use client" directive for client components using hooks like usePathname
- For Playwright tests, do NOT use `networkidle` wait - Next.js HMR keeps connections open
- Use `data-testid` attributes for test selectors
- For GPS location on web, use navigator.geolocation API (not React Native location APIs)
- For reverse geocoding, use Nominatim OpenStreetMap API (free, no API key needed)

## Learnings

---

## 2026-01-11 - US-001
Thread: https://ampcode.com/threads/T-019bad2a-e26b-71eb-b27d-f6c0dd4b9379
- Implemented project setup and navigation shell for DogTracer web app
- Files changed:
  - src/app/layout.tsx (updated metadata, added BottomNav)
  - src/app/page.tsx (new home page)
  - src/app/components/BottomNav.tsx (new bottom navigation component)
  - src/app/timeline/page.tsx (placeholder)
  - src/app/encounters/page.tsx (placeholder)
  - src/app/profile/page.tsx (placeholder)
- **Learnings for future iterations:**
  - Despite PRD saying React Native/Flutter, the actual project is Next.js web - ignore mobile-native requirements
  - Bottom navigation uses fixed positioning with pb-16 on main content to prevent overlap
  - Active tab uses amber-600 color scheme
  - Using Heroicons-style SVG icons for navigation
  - Browser test at scripts/ralph/smoke.spec.ts checks homepage loads with title
---

## 2026-01-11 - US-003
Thread: https://ampcode.com/threads/T-019bad34-5020-7315-8474-cdaf405a7d82
- Implemented GPS location capture for moments with reverse geocoding
- Files changed:
  - src/app/lib/moments.ts (added GpsLocation interface, updated Moment interface and createMoment function)
  - src/app/lib/location.ts (new file - geolocation and reverse geocoding utilities)
  - src/app/components/CameraButton.tsx (integrated location capture, added loading state, shows place label in confirmation)
- **Learnings for future iterations:**
  - Use navigator.geolocation.getCurrentPosition() for web browser location
  - Nominatim OpenStreetMap reverse geocoding is free and doesn't need API key
  - GpsLocation stores: latitude, longitude, accuracy (meters), placeLabel (nullable)
  - Location is captured in parallel with photo reading for better performance
  - Handle location gracefully when unavailable (gps field is null)
  - Button shows loading spinner while capturing location
  - Confirmation message includes place label when available
---

## 2026-01-11 - US-002
Thread: https://ampcode.com/threads/T-019bad2f-a139-744a-b3d8-6ee6bce5dc96
- Implemented moment capture with photo and timestamp
- Files changed:
  - src/app/page.tsx (added CameraButton component)
  - src/app/components/CameraButton.tsx (new camera capture component with confirmation feedback)
  - src/app/lib/moments.ts (new local storage utility for moments)
  - scripts/ralph/smoke.spec.ts (added camera button visibility test, fixed networkidle issue)
- **Learnings for future iterations:**
  - Use `capture="environment"` attribute on file input for mobile camera access
  - For photo capture on web, use file input with `accept="image/*"` - works on both desktop and mobile
  - Store photos as base64 data URLs in localStorage for simplicity (IndexedDB for larger apps)
  - Moment interface: id, photoDataUrl, timestamp (ISO), timestampLocal, createdAt
  - Playwright tests fail with `networkidle` on Next.js dev server due to HMR - use default `load` wait
  - Added `data-testid="camera-button"` for test selectors
---

## 2026-01-11 - US-004
Thread: https://ampcode.com/threads/T-019bad37-068b-74d8-b8e2-1448ebcfbba3
- Implemented quick tags and notes for moment capture
- Files changed:
  - src/app/lib/moments.ts (added MomentTag type, MOMENT_TAGS constant, tags/notes fields to Moment interface)
  - src/app/components/TagsModal.tsx (new modal component with tag selection and notes input)
  - src/app/components/CameraButton.tsx (integrated TagsModal, show modal after photo capture before saving)
  - scripts/ralph/smoke.spec.ts (added test for tags modal UI elements)
- **Learnings for future iterations:**
  - Modal appears after photo capture, before moment is saved to localStorage
  - Tags are toggleable buttons with emoji icons for visual feedback
  - Selected tags use amber-500 background, unselected use gray-100
  - Notes field is optional textarea below tags
  - Cancel button discards the pending capture
  - Save button commits moment with selected tags and notes
  - All 9 preset tags implemented: walk, play, rest, training, feeding, vet, bath, social, stress
---
